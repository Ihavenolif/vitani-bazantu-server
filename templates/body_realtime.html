<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        @keyframes pripsani_bodu {
            0%{
                opacity: 0;
                transform: translate(0,0);
            }
            25%{
                opacity: 1;
                transform: translate(0,0);
            }
            50%{
                opacity: 1;
                transform: translate(0,0);
            }
            100%{
                opacity: 0;
                transform: translate(-100%,0);
            }
        }

        .pripsani_bodu{
            animation-name: pripsani_bodu;
            animation-duration: 2s;
            animation-fill-mode: forwards;
        }
    </style>
</head>
<body style="margin: 0; padding: 0;">
    <div class="container-fluid" style="height: 100vh;">
        <div class="row" style="height: 100%;">
            <div class="col-sm-2">
                <div style="height: 10vh;"></div>

                <div style="position: absolute; transform:translate(0px, 0%); width:100%; height: 26vh; transition: 1s;" id="body-box-a">
                    <div style="height: 10%;"></div>
                    <h1 style="text-align: center; line-height: 21vh;">1.A</h1>
                </div>

                <div style="position: absolute; transform:translate(0px, 100%); width:100%; height: 26vh; transition: 1s;" id="body-box-b">
                    <div style="height: 10%;"></div>
                    <h1 style="text-align: center; line-height: 21vh;">1.B</h1>
                </div>

                <div style="position: absolute; transform:translate(0px, 200%); width:100%; height: 26vh; transition: 1s;" id="body-box-c">
                    <div style="height: 10%;"></div>
                    <h1 style="text-align: center; line-height: 21vh;">1.C</h1>
                </div>
            </div>

            <div class="col-sm-8" id="content-box">
                <div style="height: 10vh;"></div>

                <div style="position: absolute; transform:translate(0px, 0%); width:100%; height: 26vh; transition: 1s;" id="progress-box-a">
                    <div style="height: 10%;"></div>
                    <div class="progress" style="height: 80%; width:0%; transition: 1s;" id="progress-bar-a" >
                        <div class="progress-bar" role="progressbar" aria-valuenow="70"
                        aria-valuemin="0" aria-valuemax="100" style="width: 100%; background-color: #f07890;">
                          <h2 style="-webkit-text-stroke: 2px black !important; font-size: 800%; color: #fff;" id="body-text-a">0</h2>
                        </div>
                    </div> 
                </div>

                <div style="position: absolute; transform:translate(0px, 100%); width:100%; height: 26vh; transition: 1s;" id="progress-box-b">
                    <div style="height: 10%;"></div>
                    <div class="progress"  style="height: 80%; width:0%; transition: 1s;" id="progress-bar-b" >
                        <div class="progress-bar" role="progressbar" aria-valuenow="70"
                        aria-valuemin="0" aria-valuemax="100" style="width: 100%; background-color: #9191ed;">
                          <h2 style="-webkit-text-stroke: 2px black !important; font-size: 800%; color: #fff;" id="body-text-b">0</h2>
                        </div>
                    </div> 
                </div>

                <div style="position: absolute; transform:translate(0px, 200%); width:100%; height: 26vh; transition: 1s;" id="progress-box-c">
                    <div style="height: 10%;"></div>
                    <div class="progress"  style="height: 80%; width:0%; transition: 1s;" id="progress-bar-c" >
                        <div class="progress-bar" role="progressbar" aria-valuenow="70"
                        aria-valuemin="0" aria-valuemax="100" style="width: 100%; background-color: #82e8a0;">
                          <h2 style="-webkit-text-stroke: 2px black !important; font-size: 800%; color: #fff;" id="body-text-c">0</h2>
                        </div>
                    </div> 
                </div>
            </div>

            <div class="col-sm-2">
                <div style="height: 10vh;"></div>

                <div id="animated-box-a" style="position: absolute; height: 26vh; width: 90%;">
                    <div style="position: absolute; transform:translate(0px, 0%); width:90%;" class="pripsani_bodu">
                        <div style="height: 10%;"></div>
                        <h1 style="text-align: center; line-height: 21vh;"></h1>
                    </div>
                </div>

                <div id="animated-box-b" style="position: absolute; transform: translate(0, 100%); height: 26vh; width: 90%;">
                    <div style="position: absolute; transform:translate(0px, 0%); width:90%;" class="pripsani_bodu">
                        <div style="height: 10%;"></div>
                        <h1 style="text-align: center; line-height: 21vh;"></h1>
                    </div>
                </div>

                <div id="animated-box-c" style="position: absolute; transform: translate(0, 200%); height: 26vh; width: 90%;">
                    <div style="position: absolute; transform:translate(0px, 0%); width:90%;" class="pripsani_bodu">
                        <div style="height: 10%;"></div>
                        <h1 style="text-align: center; line-height: 21vh;"></h1>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        a = 0
        b = 0
        c = 0

        prvni = "a"
        druhy = "b"
        treti = "c"
        poradi = ["a","b","c"]
        queue = []

        function handleData(data){
            for (const x of data) {
                switch(x.trida){
                    case "a":
                        a += parseInt(x.pocetBodu)
                        break
                    case "b":
                        b += parseInt(x.pocetBodu)
                        break
                    case "c":
                        c += parseInt(x.pocetBodu)
                        break
                }

                pripsatBody(x.trida, x.pocetBodu)
                console.log(x)
            }
            seraditTridy()
            setTimeout(() => {
                prohodit(prvni, druhy, treti)
            }, 2000)
        }

        function seraditTridy(){
            sorted = [a,b,c].sort((a,b) => {return a-b})

            if(Math.max(a,b,c) == a){
                prvni = "a"
                if(b > c){
                    druhy = "b"
                    treti = "c"
                }else{
                    druhy = "c"
                    treti = "b"
                }
            }

            if(Math.max(a,b,c) == b){
                prvni = "b"
                if(a > c){
                    druhy = "a"
                    treti = "c"
                }else{
                    druhy = "c"
                    treti = "a"
                }
            }

            if(Math.max(a,b,c) == c){
                prvni = "c"
                if(b > a){
                    druhy = "b"
                    treti = "a"
                }else{
                    druhy = "a"
                    treti = "b"
                }
            }
        }

        function pripsatBody(trida, pocetBodu){
            document.getElementById("animated-box-" + trida).innerHTML = "<div style=\"position: absolute; transform:translate(0px, 0%); width:90%; height: 26vh;\" class=\"pripsani_bodu\"><div style=\"height: 10%;\"></div><h1 style=\"text-align: center; line-height: 21vh;\">" + pocetBodu +"</h1></div>"

            progressBar = document.getElementById("progress-bar-" + trida)
            setTimeout(() => {
                progressBarA = document.getElementById("progress-bar-a")
                progressBarA.style.width = (a / Math.max(a,b,c)) * 100 + "%"
                progressBarC = document.getElementById("progress-bar-c")
                progressBarC.style.width = (c / Math.max(a,b,c)) * 100 + "%"
                progressBarB = document.getElementById("progress-bar-b")
                progressBarB.style.width = (b / Math.max(a,b,c)) * 100 + "%"
                textA = document.getElementById("body-text-a")
                textA.innerHTML = a
                textB = document.getElementById("body-text-b")
                textB.innerHTML = b
                textC = document.getElementById("body-text-c")
                textC.innerHTML = c
            }, 1000);
            
            

            console.log("prvni: " + prvni)
            console.log("druhy: " + druhy)
            console.log("treti: " + treti)
            

            /*setTimeout(() => {
                prohodit(prvni, druhy, treti)
            }, 2000)*/

            
            /*progressBar.style.setProperty(trida + "Before", "50%")
            progressBar.style.setProperty(trida + "After", "70%")
            progressBar.style.classList.add("update_progress_baru_" + trida)*/
        }

        function prohodit(trida1, trida2, trida3){
            progressBox1 = undefined
            bodyBox1 = undefined
            animatedBox1 = undefined
            progressBox2 = undefined
            bodyBox2 = undefined
            animatedBox2 = undefined
            progressBox3 = undefined
            bodyBox3 = undefined
            animatedBox3 = undefined

            if(trida1 != poradi[0]){
                progressBox1 = document.getElementById("progress-box-" + trida1)
                bodyBox1 = document.getElementById("body-box-" + trida1)
                animatedBox1 = document.getElementById("animated-box-" + trida1)
            }
            if(trida2 != poradi[1]){
                progressBox2 = document.getElementById("progress-box-" + trida2)
                bodyBox2 = document.getElementById("body-box-" + trida2)
                animatedBox2 = document.getElementById("animated-box-" + trida2)
            }
            if(trida3 != poradi[2]){
                progressBox3 = document.getElementById("progress-box-" + trida3)
                bodyBox3 = document.getElementById("body-box-" + trida3)
                animatedBox3 = document.getElementById("animated-box-" + trida3)
            }

            try {
                progressBox1.style.opacity = 0.5
                bodyBox1.style.opacity = 0.5
                animatedBox1.style.opacity = 0.5

                setTimeout(() => {
                    progressBox1.style.transform = "translate(0,0)"
                    bodyBox1.style.transform = "translate(0,0)"
                    animatedBox1.style.transform = "translate(0,0)"
                }, 1000);

                setTimeout(() => {
                    progressBox1.style.opacity = 1
                    bodyBox1.style.opacity = 1
                    animatedBox1.style.opacity = 1
                }, 2000);
            } catch (error) {
                console.log(error)
            }

            try {
                progressBox2.style.opacity = 0.5
                bodyBox2.style.opacity = 0.5
                animatedBox2.style.opacity = 0.5

                setTimeout(() => {
                    progressBox2.style.transform = "translate(0,100%)"
                    bodyBox2.style.transform = "translate(0,100%)"
                    animatedBox2.style.transform = "translate(0,100%)"
                }, 1000);

                setTimeout(() => {
                    progressBox2.style.opacity = 1
                    bodyBox2.style.opacity = 1
                    animatedBox2.style.opacity = 1
                }, 2000);
            } catch (error) {
                console.log(error)
            }

            try {
                progressBox3.style.opacity = 0.5
                bodyBox3.style.opacity = 0.5
                animatedBox3.style.opacity = 0.5

                setTimeout(() => {
                    progressBox3.style.transform = "translate(0,200%)"
                    bodyBox3.style.transform = "translate(0,200%)"
                    animatedBox3.style.transform = "translate(0,200%)"
                }, 1000);

                setTimeout(() => {
                    progressBox3.style.opacity = 1
                    bodyBox3.style.opacity = 1
                    animatedBox3.style.opacity = 1
                }, 2000);
            } catch (error) {
                console.log(error)
            }

            poradi = [trida1, trida2, trida3]
        }

        //INIT THE WEBSOCKET

        const IP = "gvnqrkod.cz"

        const socket = new WebSocket("ws://" + IP + ":6969")

        socket.addEventListener("open", (event) => {
            alert("Connected successfully")
        })

        socket.addEventListener("message", (event) => {
            handleData(JSON.parse(event.data))
        })
    </script>
</body>
</html>